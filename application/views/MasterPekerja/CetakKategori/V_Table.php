<a id="exportExcel" href="<?= base_url("MasterPekerja/cetakkategori/exportExcel") ?>" class="btn btn-md btn-success">Export Excel<i class="ml-3 fa fa-file-excel-o fa-2"></i></a>
<table id="TDP_viewall" class="table table-bordered table-hover text-left">
    <thead class="bg-primary">
        <tr>
            <!-- Class tdp_th Wajib Diberi -->
            <th class="tdp_th no">No</th>
            <th class="tdp_th induk">No Induk</th>
            <th class="tdp_th nama">Nama</th>
            <th class="tdp_th jenkel">Jenis Kelamin</th>
            <th class="tdp_th agama">Agama</th>
            <th class="tdp_th tempatlahir">Tempat Lahir</th>
            <th class="tdp_th tgllahir">Tgl. Lahir</th>
            <th class="tdp_th goldarah">Gol. Darah</th>
            <th class="tdp_th nik">NIK</th>
            <th class="tdp_th no_kk">NO KK</th>
            <th class="tdp_th nohp">NO HP</th>
            <th class="tdp_th notelepon">NO Telepon</th>
            <th class="tdp_th status_keluarga">Nama Keluarga</th>
            <th class="tdp_th status_keluarga">Status Keluarga</th>
            <th class="tdp_th alamat">Alamat</th>
            <th class="tdp_th prop">Provinsi</th>
            <th class="tdp_th kab">Kabupaten</th>
            <th class="tdp_th kec">Kecamatan</th>
            <th class="tdp_th desa">Desa</th>
            <th class="tdp_th kodepos">Kode Pos</th>
            <th class="tdp_th statrumah">Status Rumah</th>
            <th class="tdp_th almt_kost">Alamat Kost</th>
            <th class="tdp_th gelard">Gelar Depan</th>
            <th class="tdp_th gelarb">Gelar Belakang</th>
            <th class="tdp_th pendidikan">Pendidikan</th>
            <th class="tdp_th jurusan">Jurusan</th>
            <th class="tdp_th sekolah">Sekolah</th>
            <th class="tdp_th namaayah">Nama Ayah</th>
            <th class="tdp_th namaibu">Nama Ibu</th>
            <th class="tdp_th statnikah">Status Nikah</th>
            <th class="tdp_th tglnikah">Tgl. Nikah</th>
            <th class="tdp_th jumanak">Jumlah Anak</th>
            <th class="tdp_th jumsdr">Jumlah Saudara</th>
            <th class="tdp_th jtanak">JT Anak</th>
            <th class="tdp_th jtbknanak">JTBKN Anak</th>
            <th class="tdp_th email_internal">Email Internal</th>
            <th class="tdp_th email_external">Email</th>
            <th class="tdp_th telkomsel_mygroup">Telkomsel Myroup</th>
            <th class="tdp_th pidgin">Akun Pidgin</th>
            <th class="tdp_th uk_baju">Ukuran Baju</th>
            <th class="tdp_th jenis_baju">Jenis Baju</th>
            <th class="tdp_th uk_celana">Ukuran Celana</th>
            <th class="tdp_th uk_sepatu">Ukuran Sepatu</th>
            <th class="tdp_th kodesie">Kode Sie</th>
            <th class="tdp_th kodejabatan">Kode Jabatan</th>
            <th class="tdp_th jabatan">Jabatan</th>
            <th class="tdp_th dept">Departemen</th>
            <th class="tdp_th unit">Unit</th>
            <th class="tdp_th seksi">Seksi</th>
            <th class="tdp_th bidang">Bidang</th>
            <th class="tdp_th pekerjaan">Pekerjaan</th>
            <th class="tdp_th asalkantor">Kantor Asal</th>
            <th class="tdp_th lokasi_kerja">Lokasi Kerja</th>
            <th class="tdp_th ruang">Ruang</th>
            <th class="tdp_th asal_outsourcing">Asal Outsourcing</th>
            <th class="tdp_th golkerja">Gol. Kerja</th>
            <th class="tdp_th masukkerja">Tgl. Masuk Kerja</th>
            <th class="tdp_th diangkat">Tgl. Diangkat</th>
            <th class="tdp_th lmkontrak">Lama Kontrak</th>
            <th class="tdp_th akhkontrak">Akhir Kontrak</th>
            <th class="tdp_th mulai_perpanjangan">Mulai Perpanjangan</th>
            <th class="tdp_th lama_perpanjangan">Lama Perpanjangan</th>
            <th class="tdp_th tglkeluar">Tgl. Keluar</th>
            <th class="tdp_th sebabklr">Sebab Keluar</th>
            <th class="tdp_th status_diangkat">Status Diangkat</th>
            <th class="tdp_th masa_kerja">Masa Kerja</th>
            <th class="tdp_th jabatan_upah">Jabatan Upah</th>
            <th class="tdp_th status_jabatan">Status Jabatan</th>
            <th class="tdp_th statpajak">Status Pajak</th>
            <th class="tdp_th npwp">NPWP</th>
            <th class="tdp_th makan">Tempat Makan</th>
            <th class="tdp_th makan1">Tempat Makan 1</th>
            <th class="tdp_th makan2">Tempat Makan 2</th>
            <th class="tdp_th tglspsi">Tgl. Daftar SPSI</th>
            <th class="tdp_th nospsi">No. SPSI</th>
            <th class="tdp_th tglkop">Tgl. Daftar Koperasi</th>
            <th class="tdp_th nokop">No. Koperasi</th>
            <th class="tdp_th nokeb">No. Keb</th>
            <th class="tdp_th upamk">Ang_upamk</th>
            <th class="tdp_th nokes">No. Kes</th>
            <th class="tdp_th tglmulaik">Tgl. Mulai</th>
            <th class="tdp_th tglakhirk">Tgl. Akhir</th>
            <th class="tdp_th bpu">BPU</th>
            <th class="tdp_th bpg">BPG</th>
            <th class="tdp_th rsb">RSB</th>
            <th class="tdp_th dokterjpk">Dokter JPK</th>
            <th class="tdp_th nokpj">No. KPJ</th>
            <th class="tdp_th tglmulai">Tgl. Mulai</th>
            <th class="tdp_th tglakhir">Tgl. Akhir</th>
            <th class="tdp_th pensiun">Kartu Jaminan Pensiun</th>
            <th class="tdp_th nik_vaksinasi">NIK Peserta Vaksinasi</th>
            <th class="tdp_th nama_vaksinasi">Nama Peserta Vaksinasi</th>
            <th class="tdp_th status_vaksin">Status Vaksinasi</th>
            <th class="tdp_th jenis_vaksin">Jenis Vaksin</th>
            <th class="tdp_th tgl_vaksin_1">Tgl. Vaksin 1</th>
            <th class="tdp_th tgl_vaksin_2">Tgl. Vaksin 2</th>
            <th class="tdp_th lokasi_vaksin">Lokasi Vaksinasi</th>
            <th class="tdp_th kelompok_vaksin">Kelompok Vaksinasi</th>
            <th class="tdp_th anggota_serumah">Anggota Serumah</th>
        </tr>  
    </thead>
    <tbody>
        <?php foreach ($FilterAktif as $key => $val) : {
                if (isset($select)) {
        ?>
                    <tr>
                        <td><?= ($key + 1) ?></td>
                        <?php
                        if (in_array("tp.noind", $select)) {
                            echo "<td>" . $val['noind'] . "</td>";
                        }
                        if (in_array("tp.nama", $select)) {
                            echo "<td>" . $val['nama'] . "</td>";
                        }
                        if (in_array("tp.jenkel", $select)) {
                            echo "<td>" . $val['jenkel'] . "</td>";
                        }
                        if (in_array("tp.agama", $select)) {
                            echo "<td>" . $val['agama'] . "</td>";
                        }
                        if (in_array("tp.templahir", $select)) {
                            echo "<td>" . $val['templahir'] . "</td>";
                        }
                        if (in_array("to_char(tgllahir, 'DD-MM-YYYY') AS tgllahir", $select)) {
                            echo "<td>" . $val['tgllahir'] . "</td>";
                        }
                        if (in_array("tp.goldarah", $select)) {
                            echo "<td>" . $val['goldarah'] . "</td>";
                        }
                        if (in_array("tp.nik", $select)) {
                            echo "<td>" . $val['nik'] . "</td>";
                        }
                        if (in_array("tp.no_kk", $select)) {
                            echo "<td>" . $val['no_kk'] . "</td>";
                        }
                        if (in_array("tp.nohp", $select)) {
                            echo "<td>" . $val['nohp'] . "</td>";
                        }
                        if (in_array("tp.telepon", $select)) {
                            echo "<td>" . $val['telepon'] . "</td>";
                        }
                        if (in_array("tk.nama_keluarga,tk.status_keluarga", $select)) {
                            $nama_kel = array_map(function ($nk) {
                                return "<tr>" . "<td>" . $nk . "</td>" . "</tr>";
                            }, explode(';', $val['nama_keluarga']));

                            echo "<td style='white-space:nowrap; padding:0!important;'>" . "<table class='table table-bordered' style='margin:0!important;'>" . implode(' ', $nama_kel) . "</table>" . "</td>";

                            $status_kel = array_map(function ($sk) {
                                return "<tr>" . "<td>" . $sk . "</td>" . "</tr>";
                            }, explode(';', $val['status_keluarga']));
                            echo "<td style='white-space:nowrap; padding:0!important;'>" . "<table class='table table-bordered' style='margin:0!important;'>" . implode(' ', $status_kel) . "</table>" . "</td>";
                        }
                        if (in_array("tp.alamat", $select)) {
                            echo "<td>" . $val['alamat'] . "</td>";
                        }
                        if (in_array("tp.prop", $select)) {
                            echo "<td>" . $val['prop'] . "</td>";
                        }
                        if (in_array("tp.kab", $select)) {
                            echo "<td>" . $val['kab'] . "</td>";
                        }
                        if (in_array("tp.kec", $select)) {
                            echo "<td>" . $val['kec'] . "</td>";
                        }
                        if (in_array("tp.desa", $select)) {
                            echo "<td>" . $val['desa'] . "</td>";
                        }
                        if (in_array("tp.kodepos", $select)) {
                            echo "<td>" . $val['kodepos'] . "</td>";
                        }
                        if (in_array("tp.statrumah", $select)) {
                            echo "<td>" . $val['statrumah'] . "</td>";
                        }
                        if (in_array("tp.almt_kost", $select)) {
                            echo "<td>" . $val['almt_kost'] . "</td>";
                        }
                        if (in_array("tp.gelard", $select)) {
                            echo "<td>" . $val['gelard'] . "</td>";
                        }
                        if (in_array("tp.gelarb", $select)) {
                            echo "<td>" . $val['gelarb'] . "</td>";
                        }
                        if (in_array("tp.pendidikan", $select)) {
                            echo "<td>" . $val['pendidikan'] . "</td>";
                        }
                        if (in_array("tp.jurusan", $select)) {
                            echo "<td>" . $val['jurusan'] . "</td>";
                        }
                        if (in_array("tp.sekolah", $select)) {
                            echo "<td>" . $val['sekolah'] . "</td>";
                        }
                        if (in_array("(select tk.nama from hrd_khs.tkeluarga tk where nokel = '01A' and tk.noind = tp.noind limit 1) ayah", $select)) {
                            echo "<td>" . $val['ayah'] . "</td>";
                        }
                        if (in_array("(select tk.nama from hrd_khs.tkeluarga tk where nokel = '02A' and tk.noind = tp.noind limit 1) ibu", $select)) {
                            echo "<td>" . $val['ibu'] . "</td>";
                        }
                        if (in_array("tp.statnikah", $select)) {
                            echo "<td>" . $val['statnikah'] . "</td>";
                        }
                        if (in_array("to_char(tglnikah, 'DD-MM-YYYY') AS tglnikah", $select)) {
                            echo "<td>" . $val['tglnikah'] . "</td>";
                        }
                        if (in_array("tp.jumanak", $select)) {
                            echo "<td>" . $val['jumanak'] . "</td>";
                        }
                        if (in_array("tp.jumsdr", $select)) {
                            echo "<td>" . $val['jumsdr'] . "</td>";
                        }
                        if (in_array("tp.jtanak", $select)) {
                            echo "<td>" . $val['jtanak'] . "</td>";
                        }
                        if (in_array("tp.jtbknanak", $select)) {
                            echo "<td>" . $val['jtbknanak'] . "</td>";
                        }
                        if (in_array("tp.email_internal", $select)) {
                            echo "<td>" . $val['email_internal'] . "</td>";
                        }
                        if (in_array("tp.email", $select)) {
                            echo "<td>" . $val['email'] . "</td>";
                        }
                        if (in_array("tp.telkomsel_mygroup", $select)) {
                            echo "<td>" . $val['telkomsel_mygroup'] . "</td>";
                        }
                        if (in_array("tp.pidgin_account", $select)) {
                            echo "<td>" . $val['pidgin_account'] . "</td>";
                        }
                        if (in_array("tp.uk_baju", $select)) {
                            echo "<td>" . $val['uk_baju'] . "</td>";
                        }
                        if (in_array("tp.jenis_baju", $select)) {
                            echo "<td>" . $val['jenis_baju'] . "</td>";
                        }
                        if (in_array("tp.uk_celana", $select)) {
                            echo "<td>" . $val['uk_celana'] . "</td>";
                        }
                        if (in_array("tp.uk_sepatu", $select)) {
                            echo "<td>" . $val['uk_sepatu'] . "</td>";
                        }
                        if (in_array("tp.kodesie", $select)) {
                            echo "<td>" . $val['kodesie'] . "</td>";
                        }
                        if (in_array("tp.kd_jabatan", $select)) {
                            echo "<td>" . $val['kd_jabatan'] . "</td>";
                        }
                        if (in_array("tp.jabatan", $select)) {
                            echo "<td>" . $val['jabatan'] . "</td>";
                        }
                        if (in_array("ts.dept", $select)) {
                            echo "<td>" . $val['dept'] . "</td>";
                        }
                        if (in_array("ts.unit", $select)) {
                            echo "<td>" . $val['unit'] . "</td>";
                        }
                        if (in_array("ts.seksi", $select)) {
                            echo "<td>" . $val['seksi'] . "</td>";
                        }
                        if (in_array("ts.bidang", $select)) {
                            echo "<td>" . $val['bidang'] . "</td>";
                        }
                        if (in_array("case when tp.kd_pkj is null then null else (select pekerjaan from hrd_khs.tpekerjaan tpe where tp.kd_pkj = tpe.kdpekerjaan) end pekerjaan", $select)) {
                            echo "<td>" . $val['pekerjaan'] . "</td>";
                        }
                        if (in_array("tp.kantor_asal", $select)) {
                            echo "<td>" . $val['kantor_asal'] . "</td>";
                        }
                        if (in_array("tp.lokasi_kerja", $select)) {
                            echo "<td>" . $val['lokasi_kerja'] . "</td>";
                        }
                        if (in_array("tp.ruang", $select)) {
                            echo "<td>" . $val['ruang'] . "</td>";
                        }
                        if (in_array("tp.asal_outsourcing", $select)) {
                            echo "<td>" . $val['asal_outsourcing'] . "</td>";
                        }
                        if (in_array("tp.golkerja", $select)) {
                            echo "<td>" . $val['golkerja'] . "</td>";
                        }
                        if (in_array("to_char(masukkerja, 'DD-MM-YYYY') AS masukkerja", $select)) {
                            echo "<td>" . $val['masukkerja'] . "</td>";
                        }
                        if (in_array("to_char(diangkat, 'DD-MM-YYYY') AS diangkat", $select)) {
                            echo "<td>" . $val['diangkat'] . "</td>";
                        }
                        if (in_array("tp.lmkontrak", $select)) {
                            echo "<td>" . $val['lmkontrak'] . "</td>";
                        }
                        if (in_array("to_char(akhkontrak, 'DD-MM-YYYY') AS akhkontrak", $select)) {
                            echo "<td>" . $val['akhkontrak'] . "</td>";
                        }
                        if (in_array('pkwt.mulai_perpanjangan', $select)) {
                            echo "<td>" . $val['mulai_perpanjangan'] . "</td>";
                        }
                        if (in_array('pkwt.lama_perpanjangan', $select)) {
                            echo "<td>" . $val['lama_perpanjangan'] . "</td>";
                        }
                        if (in_array("to_char(tglkeluar, 'DD-MM-YYYY') AS tglkeluar", $select)) {
                            echo "<td>" . $val['tglkeluar'] . "</td>";
                        }
                        if (in_array("tp.sebabklr", $select)) {
                            echo "<td>" . $val['sebabklr'] . "</td>";
                        }
                        if (in_array("tp.status_diangkat", $select)) {
                            if ($val['status_diangkat'] == 't') {
                                echo "<td>sudah diangkat</td>";
                            } else {
                                echo "<td>belum diangkat</td>";
                            }
                        }
                        if (in_array("case when substring(tp.noind, 1,1) = 'K' then age(date(now()),date(tp.masukkerja)) when substring(tp.noind, 1,1) = 'P' then age(date(now()),date(tp.masukkerja)) when substring(tp.noind, 1,1) = 'R' then age(date(now()),date(tp.masukkerja)) else age(date(now()),date(tp.diangkat)) end as masa_kerja", $select)) {
                            echo "<td>" . str_replace(['years', 'mons', 'days', 'year', 'mon', 'day'], ['Tahun', 'Bulan', 'Hari', 'Tahun', 'Bulan', 'Hari'], $val['masa_kerja']) . "</td>";
                        }
                        if (in_array("tmj.nama_jabatan", $select)) {
                            echo "<td>" . $val['nama_jabatan'] . "</td>";
                        }
                        if (in_array("tj.nama_status", $select)) {
                            echo "<td>" . $val['nama_status'] . "</td>";
                        }
                        if (in_array("tp.statpajak", $select)) {
                            echo "<td>" . $val['statpajak'] . "</td>";
                        }
                        if (in_array("tp.npwp", $select)) {
                            echo "<td>" . $val['npwp'] . "</td>";
                        }
                        if (in_array("tp.tempat_makan", $select)) {
                            echo "<td>" . $val['tempat_makan'] . "</td>";
                        }
                        if (in_array("tp.tempat_makan1", $select)) {
                            echo "<td>" . $val['tempat_makan1'] . "</td>";
                        }
                        if (in_array("tp.tempat_makan2", $select)) {
                            echo "<td>" . $val['tempat_makan2'] . "</td>";
                        }
                        if (in_array("to_char(tglspsi, 'DD-MM-YYYY') AS tglspsi", $select)) {
                            echo "<td>" . $val['tglspsi'] . "</td>";
                        }
                        if (in_array("tp.nospsi", $select)) {
                            echo "<td>" . $val['nospsi'] . "</td>";
                        }
                        if (in_array("to_char(tglkop, 'DD-MM-YYYY') AS tglkop", $select)) {
                            echo "<td>" . $val['tglkop'] . "</td>";
                        }
                        if (in_array("tp.nokoperasi", $select)) {
                            echo "<td>" . $val['nokoperasi'] . "</td>";
                        }
                        if (in_array("tp.nokeb", $select)) {
                            echo "<td>" . $val['nokeb'] . "</td>";
                        }
                        if (in_array("tp.ang_upamk", $select)) {
                            echo "<td>" . $val['ang_upamk'] . "</td>";
                        }
                        if (in_array("tb.no_peserta as no_bpjskes", $select)) {
                            echo "<td>" . $val['no_bpjskes'] . "</td>";
                        }
                        if (in_array("to_char(tb.tglmulai, 'DD-MM-YYYY') AS tglmulaik", $select)) {
                            echo "<td>" . $val['tglmulaik'] . "</td>";
                        }
                        if (in_array("to_char(tb.tglakhir, 'DD-MM-YYYY') AS tglakhirk", $select)) {
                            echo "<td>" . $val['tglakhirk'] . "</td>";
                        }
                        if (in_array("tb.bpu", $select)) {
                            echo "<td>" . $val['bpu'] . "</td>";
                        }
                        if (in_array("tb.bpg", $select)) {
                            echo "<td>" . $val['bpg'] . "</td>";
                        }
                        if (in_array("tb.rsb", $select)) {
                            echo "<td>" . $val['rsb'] . "</td>";
                        }
                        if (in_array("tb.dokterjpk", $select)) {
                            echo "<td>" . $val['dokterjpk'] . "</td>";
                        }
                        if (in_array("ttk.no_peserta as no_bpjstk", $select)) {
                            echo "<td>" . $val['no_bpjstk'] . "</td>";
                        }
                        if (in_array("to_char(ttk.tglmulai, 'DD-MM-YYYY') AS tglmulai", $select)) {
                            echo "<td>" . $val['tglmulai'] . "</td>";
                        }
                        if (in_array("to_char(ttk.tglakhir, 'DD-MM-YYYY') AS tglakhir", $select)) {
                            echo "<td>" . $val['tglakhir'] . "</td>";
                        }
                        if (in_array("ttk.kartu_jaminan_pensiun", $select)) {
                            echo "<td>" . $val['kartu_jaminan_pensiun'] . "</td>";
                        }
                        if (in_array("tv.nik as nik_vaksinasi", $select)) {
                            echo "<td>" . $val['nik_vaksinasi'] . "</td>";
                        }
                        if (in_array("tv.nama as nama_vaksinasi", $select)) {
                            echo "<td>" . $val['nama_vaksinasi'] . "</td>";
                        }
                        if (in_array("tv.status_vaksin", $select)) {
                            echo "<td>" . $val['status_vaksin'] . "</td>";
                        }
                        if (in_array("tv.jenis_vaksin", $select)) {
                            echo "<td>" . $val['jenis_vaksin'] . "</td>";
                        }
                        if (in_array("tv.tgl_vaksin_1", $select)) {
                            echo "<td>" . $val['tgl_vaksin_1'] . "</td>";
                        }
                        if (in_array("tv.tgl_vaksin_2", $select)) {
                            echo "<td>" . $val['tgl_vaksin_2'] . "</td>";
                        }
                        if (in_array("tv.lokasi_vaksin", $select)) {
                            echo "<td>" . $val['lokasi_vaksin'] . "</td>";
                        }
                        if (in_array("tv.kelompok_vaksin", $select)) {
                            echo "<td>" . $val['kelompok_vaksin'] . "</td>";
                        }
                        if (in_array("tv.anggota_serumah", $select)) {
                            echo "<td>" . $val['anggota_serumah'] . "</td>";
                        }
                        ?>
                    </tr>
        <?php }
            }
        endforeach; ?>
        </td>