</div>
</div>
<footer class="main-footer" style="margin:0;">
  <div class="pull-right hidden-xs">
    Page rendered in <strong>{elapsed_time}</strong> seconds.
    <strong>Copyright &copy; Quick 2015<?php if (date('Y') > 2015) {
                                          echo '-' . date('Y');
                                        } ?>.</strong> All rights reserved.
  </div>
  <b>Version</b> 1.0.0
</footer>
<script>
  const baseurl = "<?= base_url() ?>";
</script>
<script src="<?= base_url('assets/plugins/core-js.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/slimScroll/jquery.slimscroll.min.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/fastclick/fastclick.min.js') ?>"></script> -->
<script src="<?= base_url('assets/theme/js/app.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/datatables-latest/datatables.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/table2excel/jquery.table2excel.min.js'); ?>"></script>
<script src="<?= base_url('assets/plugins/sweetalert2.all.min.js'); ?>"></script>
<script src="<?= base_url('assets/plugins/sweetalert2.all.js'); ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/canvasjs/canvasjs.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/chartjs/Chart.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/moment-with-locales.min.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.js') ?>"></script>
			<script src="<?= base_url('assets/plugins/bootstrap-wysihtml5/bootstrap3-wysihtml5.all.min.js') ?>"></script> -->

<!-- <script src="<?= base_url('assets/plugins/intro.js-2.9.3/intro.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/multiselect/js/bootstrap-multiselect.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/touchspin/jquery.bootstrap-touchspin.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/fine-uploader/jquery.fine-uploader.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/fine-uploader/fine-uploader.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/chartjs/Chart.bundle.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/redactor/js/redactor.min.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/mdtimepicker/mdtimepicker.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/html2canvas/html2canvas.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/highchart/highcharts.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/highchart/exporting.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/highchart/offline-exporting.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/jquery.number.min.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/uniform/jquery.uniform.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/inputlimiter/jquery.inputlimiter.1.3.1.min.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/select2/select2.full.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/chosen/chosen.jquery.min.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/colorpicker/js/bootstrap-colorpicker.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/tagsinput/jquery.tagsinput.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/validVal/js/jquery.validVal.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/dropzone/dropzone.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/daterangepicker-master/moment-precise-range.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/datepicker/js/bootstrap-datepicker.js') ?>"></script>
<script src="<?= base_url('assets/plugins/daterangepicker-master/daterangepicker.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/timepicker/js/bootstrap-timepicker.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/datetimepicker/build/jquery.datetimepicker.full.js') ?>"></script>
<script src="<?= base_url('assets/plugins/datetimepicker/build/jquery.datetimepicker.full.min.js') ?>"></script>
<script src="<?= base_url('assets/plugins/datetimepicker/build/jquery.datetimepicker.min.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/switch/static/js/bootstrap-switch.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/jquery.dualListbox-1.3/jquery.dualListBox-1.3.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/autosize/jquery.autosize.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/jasny/js/bootstrap-inputmask.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/jquery-validation-1.11.1/dist/jquery.validate.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/validator/bootstrapValidator.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/validator/bootstrapValidator.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/jquery.mask.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/iCheck/icheck.js') ?>"></script>
<script src="<?= base_url('assets/plugins/jquery.toaster/jquery.toaster.js') ?>"></script>
<script src="<?= base_url('assets/plugins/jQuery/jquery.toaster.js') ?>"></script>
<script src="<?= base_url('assets/plugins/qtip/jquery.qtip.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/jasny-bootstrap.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/inputmask/inputmask.bundle.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/sweetAlert/sweetalert.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/table-to-CSV/table2csv.js') ?>"></script>
			<script src="<?= base_url('assets/plugins/table-to-CSV/tableHTMLExport.js') ?>"></script>
			<script src="<?= base_url('assets/plugins/table-to-CSV/jspdf.min.js') ?>"></script>
			<script src="<?= base_url('assets/plugins/table-to-CSV/jspdf.plugin.autotable.min.js') ?>"></script>
			<script src="<?= base_url('assets/plugins/table-to-CSV/tableExport.js') ?>"></script>
			<script src="<?= base_url('assets/plugins/table-to-CSV/FileSaver.min.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/monthPicker/monthpicker.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/print/print.min.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/js/formValidation.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/js/jquery-maskmoney.js') ?>"></script> -->
<!-- <script src="<?= base_url('assets/plugins/howler/howler.js') ?>"></script> -->
<script src="<?= base_url('assets/plugins/fakeLoading/fakeLoading.js') ?>"></script>
<!-- <script src="<?= base_url('assets/plugins/pace/pace.min.js') ?>"></script> -->

<!-- Vue Script -->
<script src="<?= base_url('assets/plugins/vue/vue@2.6.11.js') ?>"></script>
<!-- CUSTOM SCRIPT -->
<!-- <script src="<?= base_url('assets/js/masterpekerja.pencarianpekerja.js') ?>"></script> -->

<script>
const toast_mpds = (type, message) => {
  Swal.mixin({
    toast: true,
    position: 'top-end',
    showConfirmButton: false,
    timer: 3000
  }).fire({
    customClass: 'swal-font-small',
    type: type,
    title: message
  })
}

const toastMPDSLoading = (pesan) => {
  Swal.fire({
    toast: true,
    position: 'top-end',
    onBeforeOpen: () => {
       Swal.showLoading();
       $('.swal2-loading').children('button').css({'width': '20px', 'height': '20px'})
     },
    text: pesan
  })
}

const swalMPDSLarge = (type, a) =>{
  Swal.fire({
    allowOutsideClick: true,
    type: type,
    showConfirmButton: 'Ok!',
    html: a
  })
}

function mpds_employee(kodesie) {
  $('.mpds_getnoind').select2({
    placeholder: "No Induk / Nama Pekerja..",
    tags: true,
    allowClear:true,
    minimumInputLength: 1,
    ajax: {
      url: baseurl + "MasterPekerja/DeklarasiSehat/employee",
      dataType: "JSON",
      type: "POST",
      cache: false,
      data: function(params) {
        return {
          term: params.term,
          kodesie: kodesie
        };
      },
      processResults: function(data) {
        return {
          results: $.map(data, function(obj) {
            return {
              id: `${obj.noind}`,
              text:`${obj.nama} - ${obj.noind}`
            }
          })
        }
      }
    }
  })
}

  $(document).ready(function() {
    // $('.logmenu1[href!=#], .logmenu2[href!=#], logmenu3[href!=#]').click(function() {
    //   let menu = $(this).text().trim()
    //
    //   $.ajax({
    //     data: {
    //       menu1: menu
    //     },
    //     type: 'POST',
    //     url: baseurl + 'getLog'
    //   });
    // })
    $(".mpds_range_tgl").daterangepicker(
    {
      showDropdowns: true,
      autoApply: true,
      locale: {
        format: "DD-MM-YYYY",
        separator: " - ",
        applyLabel: "OK",
        cancelLabel: "Batal",
        fromLabel: "Dari",
        toLabel: "Hingga",
        customRangeLabel: "Custom",
        weekLabel: "W",
        daysOfWeek: ["Mg", "Sn", "Sl", "Rb", "Km", "Jm", "Sa"],
        monthNames: [
          "Januari",
          "Februari",
          "Maret",
          "April",
          "Mei",
          "Juni",
          "Juli",
          "Agustus ",
          "September",
          "Oktober",
          "November",
          "Desember",
        ],
        firstDay: 1,
      }
    });

    $('.mpds_getseksi').select2({
      placeholder: "Pilih Seksi..",
      tags: true,
      allowClear:true,
      minimumInputLength: 3,
      ajax: {
        url: baseurl + "MasterPekerja/DeklarasiSehat/getSeksi",
        dataType: "JSON",
        type: "POST",
        cache: false,
        data: function(params) {
          return {
            term: params.term
          };
        },
        processResults: function(data) {
          return {
            results: $.map(data, function(obj) {
              return {
                id: `${obj.kodesie}`,
                text:`${obj.seksi}`,
                kodesie:`${obj.kodesie}`
              }
            })
          }
        }
      }
    })
    $('.mpds_pertanyaan').select2({
      tags: true,
      tokenSeparators: [',', ' ']
    });
    mpds_employee('')
  })


  $('.mpds_getseksi').on('change', function() {
    mpds_employee($(this).val())
    if ($(this).val() != '') {
      toast_mpds('info', `Me-filter No. Induk dengan seksi ${$(this).select2('data')[0].text}`);
    }
  })

  function mpds_excel() {
    let tanggal = $(".mpds_range_tgl").val().split(' - ');
    let kodesie = $('.mpds_getseksi').val();
    let noind = $('.mpds_getnoind').val();
    let pertanyaan = $('.mpds_pertanyaan').val();
    $.ajax({
      url: baseurl + 'MasterPekerja/DeklarasiSehat/excelds',
      type: 'POST',
      dataType: 'JSON',
      data : {
        tanggal_awal : tanggal[0],
        tanggal_akhir : tanggal[1],
        kodesie : kodesie,
        noind : noind,
        pertanyaan : pertanyaan,
        seksi: $('.mpds_getseksi').select2('data')[0].text
      },
      cache: false,
      beforeSend: function() {
        toastMPDSLoading('Sedang Memproses Data Excel...')
      },
      success: function(result) {
        if (result != 'kosong') {
          toast_mpds('success', 'Selesai Mengexport Excel '+result)
          window.open(baseurl+'/assets/upload/GeneratorTSKK/'+result);
          $.ajax({
            url: baseurl + 'MasterPekerja/DeklarasiSehat/hapus_file',
            type: 'POST',
            dataType: 'JSON',
            data : {
              filename : result
            },
            cache: false,
            success: function(result_) {
              if (result_) {
                console.log('Berhasil Menghapus File Excel di Server');
              }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
            swalMPDSLarge('error', `${XMLHttpRequest.responseText}`);
             console.error();
            }
          })
        }else {
          toast_mpds('warning', 'Tidak Dapat Mengexport Excel, Data Kosong')
        }

      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
      swalMPDSLarge('error', `${XMLHttpRequest.responseText}`);
       console.error();
      }
    })
  }

  function mpds_pdf() {
    let tanggal = $(".mpds_range_tgl").val().split(' - ');
    let kodesie = $('.mpds_getseksi').val();
    let noind = $('.mpds_getnoind').val();
    let pertanyaan = $('.mpds_pertanyaan').val();
    $.ajax({
      url: baseurl + 'MasterPekerja/DeklarasiSehat/pdf',
      type: 'POST',
      dataType: 'JSON',
      data : {
        tanggal_awal : tanggal[0],
        tanggal_akhir : tanggal[1],
        kodesie : kodesie,
        noind : noind,
        pertanyaan : pertanyaan,
        seksi: $('.mpds_getseksi').select2('data')[0].text
      },
      cache: false,
      beforeSend: function() {
        toastMPDSLoading('Sedang Memproses Data PDF...')
      },
      success: function(result) {
        if (result != 'kosong') {
          toast_mpds('success', 'Selesai Mengexport PDF '+result)
          window.open(baseurl+'/assets/upload/GeneratorTSKK/'+result);
          $.ajax({
            url: baseurl + 'MasterPekerja/DeklarasiSehat/hapus_file',
            type: 'POST',
            dataType: 'JSON',
            data : {
              filename : result
            },
            cache: false,
            success: function(result_) {
              if (result_) {
                console.log('Berhasil Menghapus File PDF di Server');
              }
            },
            error: function(XMLHttpRequest, textStatus, errorThrown) {
            swalMPDSLarge('error', `${XMLHttpRequest.responseText}`);
             console.error();
            }
          })
        }else {
          toast_mpds('warning', 'Tidak Dapat Mengexport PDF, Data Kosong')
        }

      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
      swalMPDSLarge('error', `${XMLHttpRequest.responseText}`);
       console.error();
      }
    })
  }

  function mpds_getdata() {
    let tanggal = $(".mpds_range_tgl").val().split(' - ');
    let kodesie = $('.mpds_getseksi').val();
    let noind = $('.mpds_getnoind').val();
    let pertanyaan = $('.mpds_pertanyaan').val();
    $.ajax({
      url: baseurl + 'MasterPekerja/DeklarasiSehat/getDataFiltered',
      type: 'POST',
      data : {
        tanggal_awal : tanggal[0],
        tanggal_akhir : tanggal[1],
        kodesie : kodesie,
        noind : noind,
        pertanyaan : pertanyaan
      },
      cache: false,
      beforeSend: function() {
        $('.mon_d_sehat').html(`<div style ="width: 70%;margin:auto;height: 30%;background: #fff;overflow: hidden;z-index: 9999;padding:20px 0 30px 0;border-radius:10px;text-align:center">
                                    <img style="width: 8%;" src="${baseurl}assets/img/gif/loading5.gif"><br>
                                    <span style="font-size:14px;font-weight:bold">Sedang memuat data...</span>
                                </div>`)
      },
      success: function(result) {
        $('.mon_d_sehat').html(result);
      },
      error: function(XMLHttpRequest, textStatus, errorThrown) {
      swalMPDSLarge('error', `${XMLHttpRequest.responseText}`);
       console.error();
      }
    })
  }

</script>
</body>

</html>
